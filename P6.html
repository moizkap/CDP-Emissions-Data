<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.1.6.min.js"></script>
  <script src="http://benschmidt.org/colorbar/colorbar.js"></script>
</head>


<body>
  
<script type="text/javascript">

function draw(data) {
    
    /*
    D3.js setup code (taken from course)
    */
    
    "use strict";
    var margin = 75,
        width = 1400 - margin,
        height = 600 - margin;

    var svg = d3.select("body")
        .append("svg")
        .attr("width", width + margin)
        .attr("height", height + margin)
        .append('g')
        .attr('class', 'chart');

    /*
    Dimple.js Chart construction code
    */

    var myChart = new dimple.chart(svg, data);
    var x = myChart.addMeasureAxis("x","Emissions per Capita (metric tonnes CO2e per person)");
    	x.fontSize = '20px';
        x.ticks = 20;
    var y = myChart.addMeasureAxis("y","Target Reduction (% off Baseline)");
    	y.fontSize = '20px';
    var color = myChart.addColorAxis("Target Date", ["#FF3300" , "#FFCC00", "#33CC00"]);
    var mySeries = myChart.addSeries([
    	"City", 
    	"Emissions per Capita (metric tonnes CO2e per person)",
    	"Target Reduction (% off Baseline)",
    	"Target Date"
    	], dimple.plot.bubble);

    mySeries.getTooltipText = function (e) {
                return [
                    "City: " + e.aggField[0],
                    "Emissions per Capita: " + e.aggField[1] + " mtCO2e/person",
                    "Target Reduction: " + e.aggField[2] + "%",
                    "Target Date: " + e.aggField[3]
                ];
            };


    var myLegend = myChart.addLegend("90%", "20%", "10%", "30%", "right");
    myChart.draw();

    /*
    Add horizontal line at 50%
    */

    // svg.append("line")
    //     .attr("x1", margin + 65)
    //     .attr("x2", 1250)
    //     .attr("y1", 325)
    //     .attr("y2", 325)
    //     .style("stroke", "blue")
    //     .style("stroke-dasharray", "3");

    // svg.append("text")
    //     .attr("dx", margin + 920)
    //     .attr("dy", 325)
    //     .style("stroke", "blue")
    //     .text("UN Recommended Target, min: 50%")
    //     .style("font-family", "sans-serif");

    /*
    Add horizontal line at 85%
    */

    // svg.append("line")
    //     .attr("x1", margin + 65)
    //     .attr("x2", 1250)
    //     .attr("y1", 180)
    //     .attr("y2", 180)
    //     .style("stroke", "blue")
    //     .style("stroke-dasharray", "3");

    // svg.append("text")
    //     .attr("dx", margin + 920)
    //     .attr("dy", 180)
    //     .style("stroke", "blue")
    //     .text("UN Recommended Target, max: 85%")
    //     .style("font-family", "sans-serif")
    //     .style("font-size", "16px");

    svg.append("rect")
        .attr("x", margin + 65)
        .attr("y", 130)
        .attr("width", 1119)
        .attr("height", 170)
        .style("stroke", "blue")
        .style("stroke-dasharray", "3")
        .style("fill", "#E3F2FD")
        .style("fill-opacity", "0.2");

    /*
    Add chart title
    */

    svg.append("text")
        .attr("x", myChart._xPixels() + myChart._widthPixels() / 2)
        .attr("y", myChart._yPixels() - 20)
        .style("text-anchor", "middle")
        .style("font-family", "sans-serif")
        .style("font-weight", "bold")
        .style("font-size", "25px")
        .text("Carbon Emissions Reduction Targets set by Cities across the world");
};

d3.csv("data.csv", draw);

</script>

</body>

</html>